import tensorflow as tf
import numpy as np
import os

## Version 1: nothing changed

# SEtting saved path
savedPath = os.path.join(os.getcwd(),"..\savedModel")

model = tf.saved_model.load(savedPath)

print(type(model))
print(model.signatures)




test = np.array([[0.8593265,-0.5249027,	0.29539275],
[0.827795,	-0.5170376,	0.43199173],
[0.8593265,	-0.34400487,	0.36770985],
[0.84356076,	-0.39119563,	0.3114632],
[0.77261496,-0.44625148,	0.2873575],
[0.8120293,	-0.42265612,	0.25521657],
[0.85144365,	-0.37546536,	0.36770985],
[0.91450655,	-0.37546536,	0.45609742],
[0.7568492,	-0.3833305,	0.39181554],
[0.81991214,	-0.47771198,	0.3998508],
[0.77261496,	-0.39119563,	0.2873575],
[0.7962635,	-0.42265612,	0.32753366],
[0.827795,	-0.40692586,	0.31949845],
[0.81991214,	-0.40692586,	0.2873575],
[0.8750922,	-0.37546536,	0.26325178],
[0.9066237,	-0.3833305,	0.1989699],
[0.93027234,	-0.43838635,	0.26325178],
[1.0248667,	-0.35186997,	0.34360415],
[1.1115782,	-0.31254435,	0.34360415],
[0.9539209,	-0.3282746,	0.26325178],
[0.74108344,	-0.37546536,	0.15879373],
[0.7804978,	-0.414791,	0.27128705],
[0.89085793,	-0.3911956,	0.34360415],
[1.0248667,	-0.36760023,	0.3516394],
[0.9618038,	-0.3911956,	0.22307563],
[0.8356779,	-0.36760023,	0.21504039],
[0.92238945,	-0.42265612,	0.23111084],
[0.88297504,	-0.414791,	0.19896992],
[0.90662366,	-0.42265612,	0.35967463],
[0.92238945,	-0.414791,	0.40788603],
[0.8593265,	-0.39906073,	0.32753366],
[0.8435607,	-0.43838635,	0.2873575],
[0.709552,	-0.36760023,	0.46413267],
[0.7332006,	-0.33613974,	0.48020312],
[0.646489, -0.3282746,	0.3757451],
[0.7016691,	-0.3833305,	0.39181554],
[0.7962636,	-0.40692586,	0.35967463],
[0.8987408,	-0.39906073,	0.3516394],
[0.9381552,	-0.46984684,	0.3275337],
[0.93027234,	-0.46984687,	0.27128705],
[0.890858,	-0.4934422,	0.3757451],
[0.8041464,	-0.40692586,	0.38378033],
[0.7253177,	-0.3282746,	0.27932227],
[0.74896634,	-0.47771198,	0.3114632],
[0.88297504,	-0.6192842,	0.20700514],
[1.0248668,	-0.4934422,	0.1989699],
[1.0879296,	-0.414791,	0.33556893],
[1.119461,	-0.5013073,	0.40788603],
[1.0721639,	-0.5013073,	0.3757451],
[0.81202924,	-0.5720935,	0.27932227]
])

test = test.reshape(1,50 * 1 * 3)

pred = model.signatures['serving_default'](x=test)
print(pred['output_0'].numpy())




converter = tf.lite.TFLiteConverter.from_saved_model(savedPath)
converter.optimizations = [tf.lite.Optimize.DEFAULT] 
tflite_model = converter.convert()
print("POST CONVERSION")
tflite_model_size = open('./modelClean.tflite', "wb").write(tflite_model)
print("Quantized model is %d bytes" % tflite_model_size)



